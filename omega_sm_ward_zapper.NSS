////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_area_onenter.nss
//      Version : 0.1
//         Date : 7/25/06
//       Author : Ronan
//
//  Local Variable Prefix =
//
//
//  Dependencies external of nwscript:
//
//  Description
//  This script calls the ACR's OnAreaEnter code, and any custom code a server
//  may need. It is not updated in ACR updates.
//
//  Revision History
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


#include "acr_db_persist_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

//! The main event handler.
void main();

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main() {
   
    // Custom code goes below this line.
	
	
	//Removing the Protection from Evil and Death Ward from those leaving Silvy's Wards
	
	object oPC = GetItemActivatedTarget();
	effect eImmunityMindSpells = EffectImmunity(IMMUNITY_TYPE_MIND_SPELLS);
	effect eSavingThrowIncreased = EffectSavingThrowIncrease(SAVING_THROW_ALL, 2, SAVING_THROW_TYPE_EVIL, FALSE);
	effect eACIncreased = EffectACIncrease(2, AC_DEFLECTION_BONUS, DAMAGE_TYPE_ALL);
	effect eImmunityDeathMagic = EffectImmunity(IMMUNITY_TYPE_DEATH);
	effect eDMGImmunityIncreasedNegative = EffectDamageImmunityIncrease(DAMAGE_TYPE_NEGATIVE, 100);
	effect eImmunityNegativeLevel = EffectImmunity(IMMUNITY_TYPE_NEGATIVE_LEVEL);
	effect eImmunityAbilityDecrease = EffectImmunity(IMMUNITY_TYPE_ABILITY_DECREASE);
		
			
 		ACR_SetPersistentInt(oPC, "Wards", 0);
	    ACR_SetPersistentObject(oPC, "Wards", OBJECT_INVALID, "Silverymoon");
	    effect eEffect = GetFirstEffect(oPC);
		while(GetIsEffectValid(eEffect) != FALSE)
			{if((eEffect == eImmunityMindSpells)
				||(eEffect == eSavingThrowIncreased)
				|| (eEffect == eACIncreased)
				|| (eEffect == eImmunityDeathMagic)
				|| (eEffect == eDMGImmunityIncreasedNegative)
				|| (eEffect == eImmunityNegativeLevel)
				|| (eEffect == eImmunityAbilityDecrease))
			
			 	{RemoveEffect(oPC, eEffect);
				}
			  eEffect = GetNextEffect(oPC);
			}
		
	
}